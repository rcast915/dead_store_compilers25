Dead Store Elimination + MemorySSA
==================================

This directory contains a sample LLVM pass that demonstrates MemorySSA
and a simple dead store elimination. Place this folder inside the LLVM
Tutor project layout.

Build the Plugin
----------------
From inside the `dead_store` directory, build the shared library:

/usr/bin/clang++ -std=c++17 -fPIC -shared MemorySSADemo.cpp \
    -o libMemorySSADemo.dylib \
    $(llvm-config --cxxflags --ldflags --system-libs --libs core analysis transformutils passes)


Running the MemorySSA Demo
--------------------------
The commands below assume a source file named `file.c`. Replace `file.c`
with any test file you want (e.g., `test1.c`, `demo.c`).

1) Generate LLVM IR:
clang -O0 -Xclang -disable-O0-optnone -S -emit-llvm file.c -o file.ll

2) Run mem2reg:
opt -passes=mem2reg file.ll -S -o file_simplified.ll

3) Run the MemorySSA demo pass:
opt -load-pass-plugin=./libMemorySSADemo.dylib \
    -passes="memssa-demo" \
    -disable-output file_simplified.ll

This prints MemorySSA information and produces:
file.memssa.dot

Convert the DOT file to PDF with:
dot -Tpdf file.memssa.dot -o file.pdf


Running Dead Store Elimination
------------------------------
Run the dead store elimination pass on the simplified IR:

opt -load-pass-plugin=./libMemorySSADemo.dylib \
    -passes="dead-store-elim" \
    -S file_simplified.ll -o file_dse.ll

Compare outputs:
diff -u file_simplified.ll file_dse.ll


Running All Tests
-----------------
To run the pass on every test case in `test/*.c`:

chmod +x run_dse_test.sh
./run_dse_test.sh

This compiles each test, applies DSE, and prints the diffs.


Files
-----
MemorySSADemo.cpp   – Implementation of MemorySSA printing and DSE  
test/*.c            – Test programs for validating DSE  
run_dse_test.sh     – Script to compile and run DSE on all tests
